<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>BelgeDedektif</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body style="background:#f4f7fb">
<div class="container mt-4">
    <h2 class="text-primary mb-3" style="font-weight: bold;">BelgeDedektif’e Hoşgeldiniz!</h2>
    <div class="input-group mb-2">
        <input type="file" id="fileInput" class="form-control">
        <button class="btn btn-success" onclick="uploadFile()">Yükle &amp; Analiz Et</button>
    </div>
    <div id="uploadStatus" class="text-success mb-2"></div>

    <div class="card mt-2">
        <div class="card-header">Son Yüklenen Belgeler</div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover mb-0">
                <thead>
                    <tr>
                        <th>Dosya</th><th>Tarih</th><th>KDV</th><th>Toplam</th><th>Firma/Kişi</th>
                    </tr>
                </thead>
                <tbody id="recordTable"></tbody>
            </table>
        </div>
    </div>
</div>
<script>
async function uploadFile() {
    const fileInput = document.getElementById('fileInput');
    if (!fileInput.files.length) return;
    const formData = new FormData();
    formData.append("file", fileInput.files[0]);
    let resp = await fetch("/upload-analyze", {method: "POST", body: formData});
    if (resp.ok) {
        document.getElementById("uploadStatus").innerText = "Yükleme tamamlandı!";
        loadRecords();
    } else {
        document.getElementById("uploadStatus").innerText = "Yükleme başarısız!";
    }
}
async function loadRecords() {
    let resp = await fetch("/records");
    let data = await resp.json();
    let html = "";
    for (const rec of data.records || []) {
        html += `<tr>
            <td>${rec.filename}</td>
            <td>${rec.date || ""}</td>
            <td>${rec.vat || ""}</td>
            <td>${rec.total || ""}</td>
            <td>${rec.vendor || ""}</td>
        </tr>`;
    }
    document.getElementById("recordTable").innerHTML = html;
}
window.onload = loadRecords;
</script>
</body>
</html>
